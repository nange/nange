- [[软件设计的哲学]]：**信息隐藏和泄露**
	- 实现深层模块最重要的技术是信息隐藏。基本思想是每个模块应封装一些知识，这些知识代表设计决策。该知识嵌入在模块的实现中，但不会出现在其界面中，因此其他模块不可见。
	- 信息隐藏在两个方面降低了复杂性。首先，它将接口简化为模块并隐藏了细节；其次，信息隐藏使系统更容易演化。例如，如果 TCP 协议发生了变化(例如，为了引入一种新的拥塞控制机制)，协议的实现就必须进行修改，但是在使用 TCP 发送和接收数据的高级代码中不需要进行任何修改。
	- 信息隐藏的反面是信息泄漏。当一个设计决策反映在多个模块中时，就会发生信息泄漏。这在模块之间创建了依赖关系：对该设计决策的任何更改都将要求对所有涉及的模块进行更改。
	- 当在多个地方使用相同的知识时，例如两个都理解特定类型文件格式的不同类，就会发生信息泄漏。
	- 如果遇到类之间的信息泄露，请自问：我如何才能重新组织这些类，使这些特定的知识只影响一个类?
		- 如果受影响的类相对较小，并且与泄漏的信息紧密相关，那么将它们合并到一个类中是有意义的。
		- 另一种方法是从所有受影响的类中提取信息，并创建一个只封装这些信息的新类。但是，这种方法只有在能够找到一个从细节中抽象出来的简单接口时才有效
	- 信息泄漏的一个常见原因是时间分解的设计风格。如：考虑一个应用程序，该应用程序以特定格式读取文件，修改文件内容，然后再次将文件写出。
		- 通过时间分解，该应用程序可以分为三类：一类用于读取文件，另一类用于执行修改，第三类用于写出新版本。
		- 文件读取和文件写入步骤都具有有关文件格式的知识，这会导致信息泄漏。
		- 解决方案是将用于读写文件的核心机制结合到一个类中。该类将在应用程序的读取和写入阶段使用。
		- 很容易陷入时间分解的陷阱，因为在编写代码时通常会想到必须执行操作的顺序。在设计模块时，应专注于执行每个任务所需的知识，而不是任务发生的顺序。
	- 举例：实现一个HTTP服务器
		- **错误一：将代码分成大量的浅层类，这导致了类之间的信息泄漏。**
			- 如用两种不同的类来接收 HTTP 请求。第一类将来自网络连接的请求读取为字符串，第二类将字符串解析。
			- 发生信息泄漏是因为不解析大量消息就无法读取 HTTP 请求。例如，Content-Length 标头指定了请求主体的长度，因此必须对标头进行解析才能计算总请求长度。结果，这两个类都需要了解 HTTP 请求的大多数结构，并且解析代码在两个类中都是重复的。
			- 由于这些类共享大量信息，因此最好将它们合并为一个同时处理请求读取和解析的类。由于它将请求格式的所有知识隔离在一个类中，因此它提供了更好的信息隐藏，并且还为调用者提供了一个更简单的接口（只需调用一种方法）。
		- **错误二：接口返回的参数太浅。这导致信息隐藏失败。**
			- 如使用`HTTPRequest`类来保存已解析的HTTP请求，并且有下面的方法来返回参数：
				- ```java
				  public Map<String, String> getParams() {
				      return this.params;
				  }
				  ```
			- 该方法不是返回单个参数，而是返回内部用于存储所有参数的映射的引用。这个方法是浅层的，它公开了 `HTTPRequest` 类用来存储参数的内部表示。对该表示的任何更改都将导致接口的更改，这将需要对所有调用者进行修改。
			- 更好的接口：
				- ```java
				  public String getParameter(String name) { ... }
				  public int getIntParameter(String name) { ... }
				  ...
				  ```
			- `getParameter` 以字符串形式返回参数值。它提供了一个比上面的 `getParams` 更深的接口；更重要的是，它隐藏了参数的内部表示。并且提供了
-